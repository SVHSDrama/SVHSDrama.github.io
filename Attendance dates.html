<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Tracker</title>
</head>
<body>

    <h2>Attendance Tracker</h2>

    <div id="attendanceList">
        <!-- Person 1 -->
        <label for="person1">Insert Name:</label>
        <select id="person1" onchange="saveAttendance('person1')">
            <option value="">--Mark Attendance--</option>
            <option value="present">Present</option>
            <option value="absent">Absent</option>
            <option value="late">Late</option>
        </select>
        <span>Present Count: <span id="presentCountPerson1">0</span></span>
        <span> | Absent Count: <span id="absentCountPerson1">0</span></span>
        <span> | Late Count: <span id="lateCountPerson1">0</span></span>
        <button onclick="resetCounters('person1')">Reset</button>
        <div>Absent Dates: 
            <select id="absentDatesPerson1">
                <option value="">--No Absences--</option>
            </select>
        </div>
        <br>

        <!-- Person 2 -->
        <label for="person2">Insert Name:</label>
        <select id="person2" onchange="saveAttendance('person2')">
            <option value="">--Mark Attendance--</option>
            <option value="present">Present</option>
            <option value="absent">Absent</option>
            <option value="late">Late</option>
        </select>
        <span>Present Count: <span id="presentCountPerson2">0</span></span>
        <span> | Absent Count: <span id="absentCountPerson2">0</span></span>
        <span> | Late Count: <span id="lateCountPerson2">0</span></span>
        <button onclick="resetCounters('person2')">Reset</button>
        <div>Absent Dates: 
            <select id="absentDatesPerson2">
                <option value="">--No Absences--</option>
            </select>
        </div>
        <br><br>

        <!-- Add more people similarly -->
    </div>

    <script>
        // Function to save attendance and count each type
        function saveAttendance(personId) {
            const attendanceValue = document.getElementById(personId).value;
            localStorage.setItem(personId, attendanceValue);

            const currentDate = new Date().toLocaleDateString();

            // Handle the different attendance types
            if (attendanceValue === 'present') {
                incrementCount(personId, 'presentCount');
            } else if (attendanceValue === 'absent') {
                incrementCount(personId, 'absentCount');
                addAbsentDate(personId, currentDate);
            } else if (attendanceValue === 'late') {
                incrementCount(personId, 'lateCount');
            }
        }

        // Function to increment the count of attendance types
        function incrementCount(personId, countType) {
            let count = parseInt(localStorage.getItem(personId + '_' + countType)) || 0;
            count += 1;
            localStorage.setItem(personId + '_' + countType, count);
            document.getElementById(countType + capitalizeFirstLetter(personId)).innerText = count;
        }

        // Function to add the current date to the list of absent dates
        function addAbsentDate(personId, date) {
            let absentDates = JSON.parse(localStorage.getItem(personId + '_absentDates')) || [];
            absentDates.push(date);
            localStorage.setItem(personId + '_absentDates', JSON.stringify(absentDates));
            updateAbsentDatesDropdown(personId, absentDates);
        }

        // Function to display absent dates in a dropdown menu
        function updateAbsentDatesDropdown(personId, absentDates) {
            const absentDatesDropdown = document.getElementById('absentDates' + capitalizeFirstLetter(personId));
            absentDatesDropdown.innerHTML = '';  // Clear current dropdown

            if (absentDates.length === 0) {
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.innerText = '--No Absences--';
                absentDatesDropdown.appendChild(defaultOption);
            } else {
                absentDates.forEach(date => {
                    const option = document.createElement('option');
                    option.value = date;
                    option.innerText = date;
                    absentDatesDropdown.appendChild(option);
                });
            }
        }

        // Function to load saved attendance and counts on page load
        window.onload = function() {
            const people = ['person1', 'person2']; // List of people (Add more IDs as needed)

            people.forEach(personId => {
                const savedAttendance = localStorage.getItem(personId);

                // Load saved attendance
                if (savedAttendance) {
                    document.getElementById(personId).value = savedAttendance;
                }

                // Load saved counts
                ['presentCount', 'absentCount', 'lateCount'].forEach(countType => {
                    const savedCount = localStorage.getItem(personId + '_' + countType) || 0;
                    document.getElementById(countType + capitalizeFirstLetter(personId)).innerText = savedCount;
                });

                // Load and display absent dates in the dropdown
                const savedAbsentDates = JSON.parse(localStorage.getItem(personId + '_absentDates')) || [];
                updateAbsentDatesDropdown(personId, savedAbsentDates);
            });
        }

        // Helper function to capitalize the first letter for ID purposes
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Function to reset counters and absent dates for a person
        function resetCounters(personId) {
            const counts = ['presentCount', 'absentCount', 'lateCount'];

            counts.forEach(countType => {
                // Reset the count in localStorage
                localStorage.setItem(personId + '_' + countType, 0);
                
                // Reset the displayed count
                document.getElementById(countType + capitalizeFirstLetter(personId)).innerText = 0;
            });

            // Reset absent dates
            localStorage.setItem(personId + '_absentDates', JSON.stringify([]));
            updateAbsentDatesDropdown(personId, []);
        }
    </script>

</body>
</html>